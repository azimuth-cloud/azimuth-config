
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/azimuth-logo-blue.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.8">
    
    
      
        <title>Developing Azimuth - Azimuth Operator Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#developing-azimuth" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Azimuth Operator Documentation" class="md-header__button md-logo" aria-label="Azimuth Operator Documentation" data-md-component="logo">
      
  <img src="../assets/azimuth-logo-white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Azimuth Operator Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Developing Azimuth
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/stackhpc/azimuth-config" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Azimuth Operator Documentation" class="md-nav__button md-logo" aria-label="Azimuth Operator Documentation" data-md-component="logo">
      
  <img src="../assets/azimuth-logo-white.png" alt="logo">

    </a>
    Azimuth Operator Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/stackhpc/azimuth-config" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../try/" class="md-nav__link">
        Try Azimuth
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../best-practice/" class="md-nav__link">
        Best practice for production deployments
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../environments/" class="md-nav__link">
        Environments
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../repository/">Repository</a>
          
            <label for="__nav_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Repository" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Repository
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../repository/secrets/" class="md-nav__link">
        Managing secrets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../repository/opentofu/" class="md-nav__link">
        OpenTofu state
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../configuration/">Configuration</a>
          
            <label for="__nav_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Configuration" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Configuration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/01-prerequisites/" class="md-nav__link">
        Prerequisites
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/02-deployment-method/" class="md-nav__link">
        Deployment method
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/03-kubernetes-config/" class="md-nav__link">
        Kubernetes configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/04-target-cloud/" class="md-nav__link">
        Target OpenStack cloud
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/05-secret-key/" class="md-nav__link">
        Secret key
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/06-ingress/" class="md-nav__link">
        Ingress
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/07-platform-identity/" class="md-nav__link">
        Platform Identity
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/08-zenith/" class="md-nav__link">
        Zenith Application Proxy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/09-community-images/" class="md-nav__link">
        Community images
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/10-kubernetes-clusters/" class="md-nav__link">
        Kubernetes clusters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/11-kubernetes-apps/" class="md-nav__link">
        Kubernetes apps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/12-caas/" class="md-nav__link">
        Cluster-as-a-Service (CaaS)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/13-access-control/" class="md-nav__link">
        Access control
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/14-monitoring/" class="md-nav__link">
        Monitoring and alerting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/15-disaster-recovery/" class="md-nav__link">
        Disaster Recovery
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/16-local-customisations/" class="md-nav__link">
        Local customisations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../deployment/">Deployment</a>
          
            <label for="__nav_7">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Deployment" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Deployment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployment/automation/" class="md-nav__link">
        Automated deployments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployment/testing/" class="md-nav__link">
        Integration testing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../debugging/">Debugging</a>
          
            <label for="__nav_8">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Debugging" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Debugging
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../debugging/access-k3s/" class="md-nav__link">
        Accessing the K3s cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../debugging/access-ha/" class="md-nav__link">
        Accessing the HA cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../debugging/access-monitoring/" class="md-nav__link">
        Accessing the monitoring
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../debugging/zenith-services/" class="md-nav__link">
        Debugging Zenith services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../debugging/consul/" class="md-nav__link">
        Debugging Consul
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../debugging/kubernetes/" class="md-nav__link">
        Debugging Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../debugging/caas/" class="md-nav__link">
        Debugging Cluster-as-a-Service
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" checked>
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index md-nav__link--active">
          <a href="./">Developing</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Developing" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Developing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deploying-a-dev-instance" class="md-nav__link">
    Deploying a dev instance
  </a>
  
    <nav class="md-nav" aria-label="Deploying a dev instance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-dev-environment" class="md-nav__link">
    Creating a dev environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-dev-environment" class="md-nav__link">
    Using the dev environment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#developing-azimuth-components" class="md-nav__link">
    Developing Azimuth components
  </a>
  
    <nav class="md-nav" aria-label="Developing Azimuth components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-a-container-registry" class="md-nav__link">
    Configuring a container registry
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-the-tilt-environment" class="md-nav__link">
    Using the Tilt environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local-ui-development" class="md-nav__link">
    Local UI development
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="developing-azimuth">Developing Azimuth</h1>
<p>An Azimuth deployment consists of several interdependent components, some of which are
Azimuth-specific and some of which are third-party components. Plugging code under
development into such a system can be tricky, making development difficult and slow.</p>
<h2 id="deploying-a-dev-instance">Deploying a dev instance</h2>
<p>In order to develop Azimuth, you first need a running Azimuth instance.</p>
<p>Each developer should have their own independent instance of Azimuth for development,
as during development they will make changes to the running Azimuth components that may
conflict with or break things for others.</p>
<h3 id="creating-a-dev-environment">Creating a dev environment</h3>
<p>Azimuth supports using a single <a href="../environments/">configuration environment</a> to deploy multiple
independent Azimuth instances. When
<a href="../deployment/#activating-an-environment">activating an environment</a>, a unique instance name
can be given as a second argument to the <code>activate</code> script, e.g.:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># Activating an environment with a unique instance name</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nb">source</span><span class="w"> </span>./bin/activate<span class="w"> </span>my-environment<span class="w"> </span>jbloggs
</code></pre></div>
<p>In order for an environment to be used in this way, it must be specially prepared to be more
dynamic than an environment that you would use for staging or production. In particular, only
<a href="../configuration/02-deployment-method/#single-node">single node deployments</a> are usable in
this way, as HA deployments do not support dynamically allocating a floating IP for the ingress
controller.</p>
<p>It is recommended that you create an environment in your Azimuth configuration repository
for doing Azimuth development on your cloud. This environment should include any site-specific
customisations that are required, usually by building on a
<a href="../environments/#using-mixin-environments">site mixin</a>. The
<a href="https://github.com/stackhpc/azimuth-config/tree/devel/environments/demo">demo environment</a>
is a good starting point for this, as it is designed to be flexible and dynamic.</p>
<div class="admonition tip">
<p class="admonition-title">Producing unique values in your Azimuth configuration</p>
<p>The Ansible variable <code>azimuth_environment</code> contains the unique instance name, and
can be used in other variables in your configuration where a unique value is required
for each developer environment.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Developers should use their own application credential</p>
<p>You should not include an application credential in your development environment.
Instead, each developer can use their own application credential as described in the
next section.</p>
</div>
<h3 id="using-the-dev-environment">Using the dev environment</h3>
<p>The following instructions assume that your Azimuth configuration contains a developer environment
called <code>dev</code>. It is assumed that you have your Azimuth configuration checked out and that you have
an <a href="https://docs.openstack.org/keystone/latest/user/application_credentials.html">application credential</a>
for the target cloud.</p>
<p>To stand up your developer-specific Azimuth instance, using the <code>dev</code> environment, use the
following:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Set OpenStack configuration variables</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OS_CLOUD</span><span class="o">=</span>openstack
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OS_CLIENT_CONFIG_FILE</span><span class="o">=</span>/path/to/clouds.yaml
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="c1"># Activate the dev config environment with a specific instance name</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="c1">#</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="c1"># This means that resources created for the instance will not collide</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="c1"># with other deployments that use the dev environment</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="nb">source</span><span class="w"> </span>./bin/activate<span class="w"> </span>dev<span class="w"> </span>jbloggs-dev
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="c1"># Install Azimuth as usual</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>ansible-galaxy<span class="w"> </span>install<span class="w"> </span>-f<span class="w"> </span>-r<span class="w"> </span>requirements.yml
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>ansible-playbook<span class="w"> </span>stackhpc.azimuth_ops.provision
</code></pre></div>
<h2 id="developing-azimuth-components">Developing Azimuth components</h2>
<p>Azimuth has a number of components, mostly written in Python:</p>
<ul>
<li><a href="https://github.com/stackhpc/azimuth">Azimuth API and UI</a> - user-facing API and UI</li>
<li><a href="https://github.com/stackhpc/azimuth-caas-operator">Azimuth CaaS operator</a> - Kubernetes operator implementing CaaS functionality</li>
<li><a href="https://github.com/stackhpc/azimuth-capi-operator">Azimuth CAPI operator</a> - Kubernetes operator implementing Kubernetes and Kubernetes App functionality</li>
<li><a href="https://github.com/stackhpc/azimuth-identity-operator">Azimuth identity operator</a> - Kubernetes operator implementing platform identity</li>
<li><a href="https://github.com/stackhpc/azimuth-schedule-operator">Azimuth schedule operator</a> - Kubernetes operator implementing platform scheduling</li>
<li><a href="https://github.com/stackhpc/zenith">Zenith</a> - secure, tunnelling application proxy used to expose platform services</li>
<li><a href="https://github.com/stackhpc/cluster-api-addon-provider">Cluster API addon provider</a> - addons for Cluster API clusters</li>
<li><a href="https://github.com/stackhpc/cluster-api-janitor-openstack">Cluster API janitor for OpenStack</a> - resource cleanup for Cluster API clusters on OpenStack clouds</li>
</ul>
<p>It is useful to develop these components in the context of a running Azimuth installation,
as they have dependencies on each other.</p>
<p>To enable this, Azimuth uses <a href="https://tilt.dev/">Tilt</a> to provide a developer environment
where code under development is automatically built and injected into a live system that
you can interact with. Tilt provides a dashboard that can be used to drill down into
build failures and the logs of the components under development.</p>
<p><img alt="Azimuth in Tilt" src="tilt-interface.png" /></p>
<h3 id="prerequisites">Prerequisites</h3>
<p>In order to use Tilt to develop Azimuth, the following tools must be available on your
development machine (in addition to those required to install Azimuth itself):</p>
<ul>
<li>The <a href="https://docs.tilt.dev/install.html">Tilt CLI</a></li>
<li>A <code>docker</code> command, e.g. <a href="https://docs.docker.com/desktop/">Docker Desktop</a></li>
<li>The <a href="https://kubernetes.io/docs/tasks/tools/#kubectl">kubectl command</a></li>
<li>The <a href="https://helm.sh/docs/intro/install/">Helm CLI</a></li>
</ul>
<p>For developing the Azimuth UI, the following are also required:</p>
<ul>
<li><a href="https://nodejs.org">node.js</a></li>
<li>The <a href="https://classic.yarnpkg.com/lang/en/docs/install/">Yarn Classic</a> package manager</li>
</ul>
<h3 id="configuring-a-container-registry">Configuring a container registry</h3>
<p>Azimuth's Tilt configuration looks for a file called <code>tilt-settings.yaml</code> that defines settings
for the development environment. This file is specific to you and should not be added to version
control (it is specified in <code>.gitignore</code>).</p>
<p>In order to get the code under development into your running Azimuth instance, Tilt must have
access to a container registry that is accessible to both your development machine and the
Azimuth instance. In response to code changes, Tilt will automatically build and push images
to this registry and then configure the Azimuth instance to use them.</p>
<p>To configure the prefix for images built by Tilt, use the following setting:</p>
<div class="highlight"><span class="filename">tilt-settings.yaml</span><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># Images will be pushed to:</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="c1">#   ghcr.io/jbloggs/azimuth-api</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="c1">#   ghcr.io/jbloggs/azimuth-ui</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="c1">#   ghcr.io/jbloggs/azimuth-caas-operator</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="c1">#   ...</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="nt">image_prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/jbloggs</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>A good candidate for this is to use <a href="https://github.com/features/packages">GitHub Packages</a>
with your user account, as in the example above. This means that development builds do not
require access to or clutter up the production repositories.</p>
<p>When using GitHub Packages, the repositories that are created by Tilt when it builds images
for the first time will be private. You must log into GitHub and make them public before
your Azimuth instance can use them. Until you do this, you will see image pull errors in
the Tilt interface.</p>
</div>
<h3 id="using-the-tilt-environment">Using the Tilt environment</h3>
<p>Tilt will look for checkouts of Azimuth components as siblings of your Azimuth configuration
and include them in your development environment. For example, the following directory structure
will result in a development environment where changes to the Azimuth API, UI and CaaS operators
are built and pushed into your development Azimuth instance for testing:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>.
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>├── azimuth
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>│   ├── api
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>│   ├── chart
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>│   ├── ui
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>│   └── ...
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>├── azimuth-caas-operator
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>│   ├── Dockerfile
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>│   ├── azimuth_caas_operator
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>│   ├── charts
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>│   └── ...
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>└── myorg-azimuth-config
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>    ├── Tiltfile
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>    ├── bin
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>    ├── environments
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>    ├── tilt-settings.yaml
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>    └── ...
</code></pre></div>
<p>If you wish to prevent a particular component being included in your development environment,
even if the checkout exists as a sibling, you can configure this using the <code>enabled</code> flag for
the component in <code>tilt-settings.yaml</code>. For example, the following would prevent the CaaS
operator from being included in the development environment, even with the directory structure
above:</p>
<div class="highlight"><span class="filename">tilt-settings.yaml</span><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nt">components</span><span class="p">:</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="nt">azimuth-caas-operator</span><span class="p">:</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div>
<p>Once you have checked out all of the components that you want to develop, you can start the
development environment using:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>./bin/tilt-up
</code></pre></div>
<p>This will configure Tilt to connect to your Azimuth instance and begin watching your local
checkouts for changes. When a change is detected, Tilt will build and push an image for the
component before reconfiguring the Helm release for the component to point to the new image.
Once this process is complete, you can interact with your changes using the Azimuth UI for
your instance.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Press the space bar to launch the <a href="https://docs.tilt.dev/tutorial/3-tilt-ui.html">Tilt user interface</a>.</p>
</div>
<p>When the <code>tilt-up</code> command is terminated, all of the Helm releases for the components that
were under development are rolled back to the version that was running before the command
was started.</p>
<h3 id="local-ui-development">Local UI development</h3>
<p>Because of how the user interface is optimised for production, the container image build for
the Azimuth UI is very slow even for a minor change. Because of this, the usual Tilt flow of
build/push/deploy is not suitable for UI development.</p>
<p>To improve the feedback cycle for UI development, the Azimuth Tilt environment also builds
and runs the Azimuth UI locally using the
<a href="https://webpack.js.org/configuration/dev-server/">webpack DevServer</a>. The UI communicates
with the Azimuth API on your Azimuth dev instance using a forwarded port (this is necessary
in order for the cookie-based authentication to work properly).</p>
<p>The local version of the UI is available at <code>http://localhost:3000</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The UI container image is still built, pushed and deployed in the background.
However changes made to the JS files will be visible in the local version much faster.</p>
</div>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">July 16, 2024</span>
      
        <br>
        Created:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">July 16, 2024</span>
      
    
  </small>
</div>

              
            </article>
            
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../debugging/caas/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Debugging Cluster-as-a-Service" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Debugging Cluster-as-a-Service
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; StackHPC 2022
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tracking", "navigation.indexes", "navigation.top"], "search": "../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.0238f547.min.js"></script>
      
    
  </body>
</html>